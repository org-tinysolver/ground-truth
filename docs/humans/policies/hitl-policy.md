# Human-in-the-Loop (HITL) Policy

> **Source of Truth**: 인간 승인이 필요한 작업 범위와 기준

## 정책 목적

AI Agent가 자동화하더라도 **되돌리기 어려운 작업**은 반드시 인간의 승인을 받도록 합니다.

## 왜 HITL인가?

### 핵심 가치

- **AI는 도구**: 최종 결정은 인간이 내림
- **되돌리기 비용**: 잘못된 배포 롤백 > 사전 검토 시간
- **책임과 통제**: 인간이 결과에 대한 책임을 가짐
- **신뢰 구축**: 점진적으로 자동화 범위 확대

### 교훈

```
❌ "빠르게 하려고 HITL 스킵" → 롤백 비용 >> 검토 비용
✅ "잠깐 멈추고 확인" → 안전한 진행
```

---

## HITL 필수 작업

### 1. 배포 관련

| 작업 | HITL 필수 | 이유 |
|------|----------|------|
| 프로덕션 배포 | O | 사용자 영향 |
| 스테이징 배포 | X | 테스트 환경 |
| DNS 변경 | O | 전파 시간, 롤백 어려움 |
| API Breaking Change | O | 외부 의존성 |

### 2. 데이터/인프라

| 작업 | HITL 필수 | 이유 |
|------|----------|------|
| DB 스키마 변경 | O | 데이터 무결성 |
| 데이터 마이그레이션 | O | 되돌리기 어려움 |
| 인프라 수정 | O | 비용, 가용성 영향 |
| 환경변수 변경 | O | 시스템 동작 변경 |

### 3. 보안 관련

| 작업 | HITL 필수 | 이유 |
|------|----------|------|
| 인증/권한 변경 | O | 보안 영향 |
| 암호화 키 변경 | O | 데이터 접근 |
| 외부 API 키 수정 | O | 서비스 연동 |

### 4. 비즈니스 결정

| 작업 | HITL 필수 | 이유 |
|------|----------|------|
| 요금제 변경 | O | 수익 영향 |
| 이용약관 수정 | O | 법적 영향 |
| 사용자 데이터 삭제 | O | 되돌리기 불가 |

---

## HITL 불필요 작업

다음 작업은 AI가 자율적으로 진행 가능:

- 개발 환경 코드 변경
- 테스트 코드 작성
- 문서 업데이트 (정책 문서 제외)
- 스테이징 배포
- 코드 리뷰 요청
- PR 생성

---

## HITL 체크포인트 운영

### 1. 사전 승인 (Before)

```
[AI PM] HITL 체크포인트: 프로덕션 배포
- 배포 내용: [변경 사항 요약]
- 영향 범위: [영향받는 기능]
- 롤백 계획: [문제 시 대응]

→ 승인하시겠습니까? (Y/N)
```

### 2. 사후 확인 (After)

```
[AI PM] 작업 완료 보고
- 결과: [성공/실패]
- 확인 사항: [체크 항목]
- 다음 단계: [필요 시]

→ 확인하셨습니까? (Y/N)
```

### 3. 긴급 상황

긴급 복구가 필요한 경우:
1. 즉시 인간에게 알림
2. 자동화된 롤백 스크립트 제안
3. 인간 승인 후 실행
4. 사후 보고서 작성

---

## 승인 기록

모든 HITL 승인은 기록됩니다:

```yaml
hitl_approval:
  action: "production_deploy"
  requested_at: "2025-12-14T10:00:00Z"
  approved_by: "human"
  approved_at: "2025-12-14T10:05:00Z"
  context: "v1.2.0 릴리즈"
```

---

## 정책 예외

### 자동 승인 조건

특정 조건을 만족하면 HITL 없이 진행 가능 (향후 구현 예정):

1. **테스트 커버리지 100%**
2. **영향 범위 명확히 제한**
3. **즉시 롤백 가능**
4. **사전 승인된 변경 유형**

현재는 모든 HITL 필수 작업에 인간 승인 필요.

---

## 관련 문서

- human-docs/principles/development-philosophy.md (HITL 가치관)
- agent-docs/rules/hitl-checklist.md (실행 체크리스트)

---

## 요약

| 원칙 | 설명 |
|------|------|
| **되돌리기 어려운 작업** | 반드시 HITL |
| **사전 승인** | 작업 전 인간 확인 |
| **기록 유지** | 모든 승인 로깅 |
| **점진적 확장** | 신뢰 구축 후 자동화 확대 |
