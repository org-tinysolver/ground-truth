name: AI Dev Auto-Dispatch

on:
  issues:
    types: [labeled]

jobs:
  notify-dev:
    # handoff:pmâ†’dev ë¼ë²¨ì´ ë¶™ì€ ì´ìŠˆë§Œ ì²˜ë¦¬
    if: github.event.label.name == 'handoff:pmâ†’dev'
    runs-on: ubuntu-latest

    steps:
      - name: Notify Slack - New Task for Dev
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          if [ -n "$SLACK_WEBHOOK_URL" ]; then
            curl -X POST -H 'Content-type: application/json' \
              --data '{
                "blocks": [
                  {
                    "type": "header",
                    "text": {"type": "plain_text", "text": "ğŸ¯ AI Dev ì‘ì—… ìš”ì²­", "emoji": true}
                  },
                  {
                    "type": "section",
                    "fields": [
                      {"type": "mrkdwn", "text": "*ì´ìŠˆ:*\n#${{ github.event.issue.number }} ${{ github.event.issue.title }}"},
                      {"type": "mrkdwn", "text": "*ìš”ì²­ì:*\n${{ github.event.sender.login }}"}
                    ]
                  },
                  {
                    "type": "section",
                    "text": {"type": "mrkdwn", "text": "*ì‘ì—… ì‹œì‘ ë°©ë²•:*\n```\ngh issue view ${{ github.event.issue.number }} --repo ${{ github.repository }}\n\n# Claude Codeì—ì„œ /dev-cycle ì‹¤í–‰\n```"}
                  },
                  {
                    "type": "actions",
                    "elements": [
                      {
                        "type": "button",
                        "text": {"type": "plain_text", "text": "ğŸ“‹ ì´ìŠˆ ë³´ê¸°", "emoji": true},
                        "url": "${{ github.event.issue.html_url }}",
                        "style": "primary"
                      },
                      {
                        "type": "button",
                        "text": {"type": "plain_text", "text": "ğŸš€ Claude Code ì—´ê¸°", "emoji": true},
                        "url": "https://claude.ai/code"
                      }
                    ]
                  }
                ]
              }' \
              $SLACK_WEBHOOK_URL
          else
            echo "SLACK_WEBHOOK_URL not configured, skipping notification"
          fi

      - name: Add comment to issue
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh issue comment ${{ github.event.issue.number }} \
            --repo ${{ github.repository }} \
            --body "## ğŸ¤– AI Dev ì•Œë¦¼ ì „ì†¡ë¨

          Slackì— ì‘ì—… ìš”ì²­ì´ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤.

          ### ì‘ì—… ì‹œì‘ ë°©ë²•
          1. Claude Code ì„¸ì…˜ ì—´ê¸°
          2. ì´ ë ˆí¬ì§€í† ë¦¬ í´ë¡ 
          3. \`/dev-cycle\` ì‹¤í–‰

          \`\`\`bash
          gh issue view ${{ github.event.issue.number }} --repo ${{ github.repository }}
          \`\`\`"
